"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = __importDefault(require("express"));
const axios_1 = __importDefault(require("axios"));
const dotenv = __importStar(require("dotenv"));
const getCryptoRouter_1 = require("../routes/getCryptoRouter");
const utilities_1 = require("../utilities");
dotenv.config();
/*
* Feature: This Middleware will be called when front-end make request to '/get-exchanges'
Because the limit of Coingecko API, we will have to make 2 call to the APIs to get all the property and transform the data format to what the front end need
*/
//Make sure the API key in env is valid
if (typeof getCryptoRouter_1.apiKey === 'undefined') {
    throw new Error('Invalid api key in env file');
}
// const dummyData = [
//   {
//     id: 'binance',
//     name: 'Binance',
//     year_established: 2017,
//     country: 'Cayman Islands',
//     description: '',
//     url: 'https://www.binance.com/',
//     image:
//       'https://assets.coingecko.com/markets/images/52/small/binance.jpg?1519353250',
//     has_trading_incentive: false,
//     trust_score: 10,
//     trust_score_rank: 1,
//     trade_volume_24h_btc: 637574.9595674635,
//     trade_volume_24h_btc_normalized: 637574.9595674635,
//     volume_chart_7d: [
//       [1663542000000, '810256.7464231678224698'],
//       [1663545600000, '839307.5332753114861147'],
//       [1663549200000, '845773.7823566420766598'],
//       [1663552800000, '855690.8069610448076553'],
//       [1663556400000, '943473.1702087630220369'],
//       [1663560000000, '981474.3546998789355738'],
//       [1663563600000, '998873.7859946374929804'],
//       [1663567200000, '1017416.0983373998743844'],
//       [1663570800000, '1078921.8966049309687079'],
//       [1663574400000, '1119197.8312610296166082'],
//       [1663578000000, '1140300.9591241623433052'],
//       [1663581600000, '1147530.4991258155806011'],
//       [1663585200000, '1124761.5155640222659191'],
//       [1663588800000, '1143648.5820139860261804'],
//       [1663592400000, '1162830.0608480247595753'],
//       [1663596000000, '1177905.8914220950268628'],
//       [1663599600000, '1203953.4986586301232635'],
//       [1663603200000, '1233424.9628539827472466'],
//       [1663606800000, '1199307.7183105841632625'],
//       [1663610400000, '1197997.0187059931847003'],
//       [1663614000000, '1178722.4884105005076729'],
//       [1663617600000, '1173791.221482077719897'],
//       [1663621200000, '1175295.1468642914686505'],
//       [1663624800000, '1129831.9454974058520724'],
//       [1663628400000, '1095361.8034161237636351'],
//       [1663632000000, '1076490.0137705154760747'],
//       [1663635600000, '1079440.2939096417182415'],
//       [1663639200000, '1081648.8479208109954758'],
//       [1663642800000, '1025266.8521251639456804'],
//       [1663646400000, '1019219.3334476876661969'],
//       [1663650000000, '1006801.0704100428756845'],
//       [1663653600000, '991717.1649882010667891'],
//       [1663657200000, '949668.2290196931967776'],
//       [1663660800000, '934256.429401900160606'],
//       [1663664400000, '930366.9203988840668094'],
//       [1663668000000, '935219.7540991483829463'],
//       [1663671600000, '924196.8718333688205738'],
//       [1663675200000, '908239.2655435287600261'],
//       [1663678800000, '917259.2786055308518265'],
//       [1663682400000, '931501.0073996424300823'],
//       [1663686000000, '904984.6923646680565356'],
//       [1663689600000, '894134.226275802593172'],
//       [1663693200000, '915633.861636400432101'],
//       [1663696800000, '944025.08341864735802'],
//       [1663700400000, '952488.9089349490942839'],
//       [1663704000000, '937855.6251372569294977'],
//       [1663707600000, '928517.2668111963160595'],
//       [1663711200000, '921509.7374707496196562'],
//       [1663714800000, '922434.4792572182022378'],
//       [1663718400000, '924822.6385784488955869'],
//       [1663722000000, '914758.8028413345425758'],
//       [1663725600000, '904968.4708004256055792'],
//       [1663729200000, '903086.4956584940373411'],
//       [1663732800000, '883452.8804512458995914'],
//       [1663736400000, '879343.3978803004084864'],
//       [1663740000000, '880125.0622371427105891'],
//       [1663743600000, '916908.4695625207291889'],
//       [1663747200000, '905450.5886747925097366'],
//       [1663750800000, '895022.9417526671014849'],
//       [1663754400000, '881498.6742732757896905'],
//       [1663758000000, '874190.8695665866103686'],
//       [1663761600000, '869472.5906514443726492'],
//       [1663765200000, '855342.5837267345482163'],
//       [1663768800000, '836836.1630233144376643'],
//       [1663772400000, '825138.4687071833840229'],
//       [1663776000000, '818743.1096602843892911'],
//       [1663779600000, '790925.4006616040664184'],
//       [1663783200000, '782291.6211953503498125'],
//       [1663786800000, '937338.3660748666068688'],
//       [1663790400000, '1012447.4818130746922758'],
//       [1663794000000, '1049102.6188302402080286'],
//       [1663797600000, '1114628.0655758531091531'],
//       [1663801200000, '1147156.1068865381295051'],
//       [1663804800000, '1151039.3213029517288954'],
//       [1663808400000, '1166528.2306692019218608'],
//       [1663812000000, '1175542.368463202272897'],
//       [1663815600000, '1176108.0398419191959031'],
//       [1663819200000, '1191487.2504027203712284'],
//       [1663822800000, '1198648.2570370907258909'],
//       [1663826400000, '1210343.5730088620828108'],
//       [1663830000000, '1195732.106736473857938'],
//       [1663833600000, '1192179.7681677743673019'],
//       [1663837200000, '1197052.1269014802158323'],
//       [1663840800000, '1216516.2080482408850825'],
//       [1663844400000, '1217666.7036800244122025'],
//       [1663848000000, '1229484.6038130741324816'],
//       [1663851600000, '1241115.3281158543244256'],
//       [1663855200000, '1269250.8055460093477992'],
//       [1663858800000, '1286402.5949173065662356'],
//       [1663862400000, '1293541.8932575870322461'],
//       [1663866000000, '1307706.021675095291236'],
//       [1663869600000, '1294592.9174311518432862'],
//       [1663873200000, '1132732.6131874568265419'],
//       [1663876800000, '1073766.2939354572006213'],
//       [1663880400000, '1069215.9885121152902429'],
//       [1663884000000, '1035772.4073987987991871'],
//       [1663887600000, '1007891.3002721645858637'],
//       [1663891200000, '1008028.8477440980391486'],
//       [1663894800000, '1006461.0593161624247895'],
//       [1663898400000, '1010251.7130028996132953'],
//       [1663902000000, '1006505.0795269910100418'],
//       [1663905600000, '1002753.8365597248096219'],
//       [1663909200000, '1014182.9802159084577152'],
//       [1663912800000, '1029041.8846396137667537'],
//       [1663916400000, '1029621.5247547926877496'],
//       [1663920000000, '1039548.9172029741924843'],
//       [1663923600000, '1051282.4003858683177556'],
//       [1663927200000, '1059229.7824664371847805'],
//       [1663930800000, '1069492.9392366704710736'],
//       [1663934400000, '1090191.3515112585294985'],
//       [1663938000000, '1087091.8234899385777789'],
//       [1663941600000, '1087391.9455620396107551'],
//       [1663945200000, '1117807.7456123923362713'],
//       [1663948800000, '1117947.168708793281116'],
//       [1663952400000, '1122528.2170870094924482'],
//       [1663956000000, '1127761.9346255872415036'],
//       [1663959600000, '1137274.3409789269838134'],
//       [1663963200000, '1126626.953231469997281'],
//       [1663966800000, '1112721.660318466946515'],
//       [1663970400000, '1111325.2804370158454077'],
//       [1663974000000, '1107016.5313984058081358'],
//       [1663977600000, '1099323.6726365068675461'],
//       [1663981200000, '1123607.5233594119584739'],
//       [1663984800000, '1128081.8415076118485239'],
//       [1663988400000, '1136293.859749465281439'],
//       [1663992000000, '1126411.8295228424562701'],
//       [1663995600000, '1116592.2968405242681615'],
//       [1663999200000, '1109866.5911398037879956'],
//       [1664002800000, '1108478.074398030304913'],
//       [1664006400000, '1107161.3462280948906914'],
//       [1664010000000, '1083167.7791446960478367'],
//       [1664013600000, '1067052.0229067334864771'],
//       [1664017200000, '1048375.7887695071926289'],
//       [1664020800000, '1017086.6478017878428467'],
//       [1664024400000, '996607.4058340665037098'],
//       [1664028000000, '980715.2584518278715979'],
//       [1664031600000, '942335.7618741756175858'],
//       [1664035200000, '925290.4679101627820322'],
//       [1664038800000, '904644.2274420708289355'],
//       [1664042400000, '878500.6064601680904726'],
//       [1664046000000, '848052.6592141247633886'],
//       [1664049600000, '824157.2641271122669334'],
//       [1664053200000, '798681.3178164782410461'],
//       [1664056800000, '804822.8986641211947847'],
//       [1664060400000, '791318.578524734590659'],
//       [1664064000000, '778527.4369462967061281'],
//       [1664067600000, '754355.4300220211111897'],
//       [1664071200000, '739267.0235379927314564'],
//       [1664074800000, '720539.5025226303859832'],
//       [1664078400000, '706077.4285192767221378'],
//       [1664082000000, '692923.4383755835591404'],
//       [1664085600000, '680808.7190100609789006'],
//       [1664089200000, '672108.4535645349933391'],
//       [1664092800000, '658310.7473187572801453'],
//       [1664096400000, '649927.4515223510896876'],
//       [1664100000000, '642210.5902032321203885'],
//       [1664103600000, '640175.3744017748433958'],
//       [1664107200000, '631756.5729537488759543'],
//       [1664110800000, '634949.3043118201704063'],
//       [1664114400000, '640467.2451946333513115'],
//       [1664118000000, '640000.8880102613678013'],
//       [1664121600000, '631604.6228928968394759'],
//       [1664125200000, '631600.6842096332764193'],
//       [1664128800000, '654668.0977139755916249'],
//       [1664132400000, '656357.5800694941948117'],
//       [1664136000000, '657276.7396611296957505'],
//       [1664139600000, '656687.619850967998023'],
//       [1664143200000, '653742.0126655394608806'],
//     ],
//   },
//   {
//     id: 'okex',
//     name: 'OKX',
//     year_established: 2013,
//     country: 'Belize',
//     description: '',
//     url: 'https://www.okx.com',
//     image:
//       'https://assets.coingecko.com/markets/images/96/small/WeChat_Image_20220117220452.png?1642428377',
//     has_trading_incentive: false,
//     trust_score: 10,
//     trust_score_rank: 2,
//     trade_volume_24h_btc: 69747.52386127997,
//     trade_volume_24h_btc_normalized: 69747.52386127997,
//     volume_chart_7d: [
//       [1663542000000, '810256.7464231678224698'],
//       [1663545600000, '839307.5332753114861147'],
//       [1663549200000, '845773.7823566420766598'],
//       [1663552800000, '855690.8069610448076553'],
//       [1663556400000, '943473.1702087630220369'],
//       [1663560000000, '981474.3546998789355738'],
//       [1663563600000, '998873.7859946374929804'],
//       [1663567200000, '1017416.0983373998743844'],
//       [1663570800000, '1078921.8966049309687079'],
//       [1663574400000, '1119197.8312610296166082'],
//       [1663578000000, '1140300.9591241623433052'],
//       [1663581600000, '1147530.4991258155806011'],
//       [1663585200000, '1124761.5155640222659191'],
//       [1663588800000, '1143648.5820139860261804'],
//       [1663592400000, '1162830.0608480247595753'],
//       [1663596000000, '1177905.8914220950268628'],
//       [1663599600000, '1203953.4986586301232635'],
//       [1663603200000, '1233424.9628539827472466'],
//       [1663606800000, '1199307.7183105841632625'],
//       [1663610400000, '1197997.0187059931847003'],
//       [1663614000000, '1178722.4884105005076729'],
//       [1663617600000, '1173791.221482077719897'],
//       [1663621200000, '1175295.1468642914686505'],
//       [1663624800000, '1129831.9454974058520724'],
//       [1663628400000, '1095361.8034161237636351'],
//       [1663632000000, '1076490.0137705154760747'],
//       [1663635600000, '1079440.2939096417182415'],
//       [1663639200000, '1081648.8479208109954758'],
//       [1663642800000, '1025266.8521251639456804'],
//       [1663646400000, '1019219.3334476876661969'],
//       [1663650000000, '1006801.0704100428756845'],
//       [1663653600000, '991717.1649882010667891'],
//       [1663657200000, '949668.2290196931967776'],
//       [1663660800000, '934256.429401900160606'],
//       [1663664400000, '930366.9203988840668094'],
//       [1663668000000, '935219.7540991483829463'],
//       [1663671600000, '924196.8718333688205738'],
//       [1663675200000, '908239.2655435287600261'],
//       [1663678800000, '917259.2786055308518265'],
//       [1663682400000, '931501.0073996424300823'],
//       [1663686000000, '904984.6923646680565356'],
//       [1663689600000, '894134.226275802593172'],
//       [1663693200000, '915633.861636400432101'],
//       [1663696800000, '944025.08341864735802'],
//       [1663700400000, '952488.9089349490942839'],
//       [1663704000000, '937855.6251372569294977'],
//       [1663707600000, '928517.2668111963160595'],
//       [1663711200000, '921509.7374707496196562'],
//       [1663714800000, '922434.4792572182022378'],
//       [1663718400000, '924822.6385784488955869'],
//       [1663722000000, '914758.8028413345425758'],
//       [1663725600000, '904968.4708004256055792'],
//       [1663729200000, '903086.4956584940373411'],
//       [1663732800000, '883452.8804512458995914'],
//       [1663736400000, '879343.3978803004084864'],
//       [1663740000000, '880125.0622371427105891'],
//       [1663743600000, '916908.4695625207291889'],
//       [1663747200000, '905450.5886747925097366'],
//       [1663750800000, '895022.9417526671014849'],
//       [1663754400000, '881498.6742732757896905'],
//       [1663758000000, '874190.8695665866103686'],
//       [1663761600000, '869472.5906514443726492'],
//       [1663765200000, '855342.5837267345482163'],
//       [1663768800000, '836836.1630233144376643'],
//       [1663772400000, '825138.4687071833840229'],
//       [1663776000000, '818743.1096602843892911'],
//       [1663779600000, '790925.4006616040664184'],
//       [1663783200000, '782291.6211953503498125'],
//       [1663786800000, '937338.3660748666068688'],
//       [1663790400000, '1012447.4818130746922758'],
//       [1663794000000, '1049102.6188302402080286'],
//       [1663797600000, '1114628.0655758531091531'],
//       [1663801200000, '1147156.1068865381295051'],
//       [1663804800000, '1151039.3213029517288954'],
//       [1663808400000, '1166528.2306692019218608'],
//       [1663812000000, '1175542.368463202272897'],
//       [1663815600000, '1176108.0398419191959031'],
//       [1663819200000, '1191487.2504027203712284'],
//       [1663822800000, '1198648.2570370907258909'],
//       [1663826400000, '1210343.5730088620828108'],
//       [1663830000000, '1195732.106736473857938'],
//       [1663833600000, '1192179.7681677743673019'],
//       [1663837200000, '1197052.1269014802158323'],
//       [1663840800000, '1216516.2080482408850825'],
//       [1663844400000, '1217666.7036800244122025'],
//       [1663848000000, '1229484.6038130741324816'],
//       [1663851600000, '1241115.3281158543244256'],
//       [1663855200000, '1269250.8055460093477992'],
//       [1663858800000, '1286402.5949173065662356'],
//       [1663862400000, '1293541.8932575870322461'],
//       [1663866000000, '1307706.021675095291236'],
//       [1663869600000, '1294592.9174311518432862'],
//       [1663873200000, '1132732.6131874568265419'],
//       [1663876800000, '1073766.2939354572006213'],
//       [1663880400000, '1069215.9885121152902429'],
//       [1663884000000, '1035772.4073987987991871'],
//       [1663887600000, '1007891.3002721645858637'],
//       [1663891200000, '1008028.8477440980391486'],
//       [1663894800000, '1006461.0593161624247895'],
//       [1663898400000, '1010251.7130028996132953'],
//       [1663902000000, '1006505.0795269910100418'],
//       [1663905600000, '1002753.8365597248096219'],
//       [1663909200000, '1014182.9802159084577152'],
//       [1663912800000, '1029041.8846396137667537'],
//       [1663916400000, '1029621.5247547926877496'],
//       [1663920000000, '1039548.9172029741924843'],
//       [1663923600000, '1051282.4003858683177556'],
//       [1663927200000, '1059229.7824664371847805'],
//       [1663930800000, '1069492.9392366704710736'],
//       [1663934400000, '1090191.3515112585294985'],
//       [1663938000000, '1087091.8234899385777789'],
//       [1663941600000, '1087391.9455620396107551'],
//       [1663945200000, '1117807.7456123923362713'],
//       [1663948800000, '1117947.168708793281116'],
//       [1663952400000, '1122528.2170870094924482'],
//       [1663956000000, '1127761.9346255872415036'],
//       [1663959600000, '1137274.3409789269838134'],
//       [1663963200000, '1126626.953231469997281'],
//       [1663966800000, '1112721.660318466946515'],
//       [1663970400000, '1111325.2804370158454077'],
//       [1663974000000, '1107016.5313984058081358'],
//       [1663977600000, '1099323.6726365068675461'],
//       [1663981200000, '1123607.5233594119584739'],
//       [1663984800000, '1128081.8415076118485239'],
//       [1663988400000, '1136293.859749465281439'],
//       [1663992000000, '1126411.8295228424562701'],
//       [1663995600000, '1116592.2968405242681615'],
//       [1663999200000, '1109866.5911398037879956'],
//       [1664002800000, '1108478.074398030304913'],
//       [1664006400000, '1107161.3462280948906914'],
//       [1664010000000, '1083167.7791446960478367'],
//       [1664013600000, '1067052.0229067334864771'],
//       [1664017200000, '1048375.7887695071926289'],
//       [1664020800000, '1017086.6478017878428467'],
//       [1664024400000, '996607.4058340665037098'],
//       [1664028000000, '980715.2584518278715979'],
//       [1664031600000, '942335.7618741756175858'],
//       [1664035200000, '925290.4679101627820322'],
//       [1664038800000, '904644.2274420708289355'],
//       [1664042400000, '878500.6064601680904726'],
//       [1664046000000, '848052.6592141247633886'],
//       [1664049600000, '824157.2641271122669334'],
//       [1664053200000, '798681.3178164782410461'],
//       [1664056800000, '804822.8986641211947847'],
//       [1664060400000, '791318.578524734590659'],
//       [1664064000000, '778527.4369462967061281'],
//       [1664067600000, '754355.4300220211111897'],
//       [1664071200000, '739267.0235379927314564'],
//       [1664074800000, '720539.5025226303859832'],
//       [1664078400000, '706077.4285192767221378'],
//       [1664082000000, '692923.4383755835591404'],
//       [1664085600000, '680808.7190100609789006'],
//       [1664089200000, '672108.4535645349933391'],
//       [1664092800000, '658310.7473187572801453'],
//       [1664096400000, '649927.4515223510896876'],
//       [1664100000000, '642210.5902032321203885'],
//       [1664103600000, '640175.3744017748433958'],
//       [1664107200000, '631756.5729537488759543'],
//       [1664110800000, '634949.3043118201704063'],
//       [1664114400000, '640467.2451946333513115'],
//       [1664118000000, '640000.8880102613678013'],
//       [1664121600000, '631604.6228928968394759'],
//       [1664125200000, '631600.6842096332764193'],
//       [1664128800000, '654668.0977139755916249'],
//       [1664132400000, '656357.5800694941948117'],
//       [1664136000000, '657276.7396611296957505'],
//       [1664139600000, '656687.619850967998023'],
//       [1664143200000, '653742.0126655394608806'],
//     ],
//   },
//   {
//     id: 'ftx_spot',
//     name: 'FTX',
//     year_established: 2019,
//     country: 'Antigua and Barbuda',
//     description: '',
//     url: 'https://ftx.com/',
//     image:
//       'https://assets.coingecko.com/markets/images/451/small/F.png?1609051590',
//     has_trading_incentive: false,
//     trust_score: 10,
//     trust_score_rank: 3,
//     trade_volume_24h_btc: 45771.500720314725,
//     trade_volume_24h_btc_normalized: 45771.500720314725,
//     volume_chart_7d: [
//       [1663542000000, '810256.7464231678224698'],
//       [1663545600000, '839307.5332753114861147'],
//       [1663549200000, '845773.7823566420766598'],
//       [1663552800000, '855690.8069610448076553'],
//       [1663556400000, '943473.1702087630220369'],
//       [1663560000000, '981474.3546998789355738'],
//       [1663563600000, '998873.7859946374929804'],
//       [1663567200000, '1017416.0983373998743844'],
//       [1663570800000, '1078921.8966049309687079'],
//       [1663574400000, '1119197.8312610296166082'],
//       [1663578000000, '1140300.9591241623433052'],
//       [1663581600000, '1147530.4991258155806011'],
//       [1663585200000, '1124761.5155640222659191'],
//       [1663588800000, '1143648.5820139860261804'],
//       [1663592400000, '1162830.0608480247595753'],
//       [1663596000000, '1177905.8914220950268628'],
//       [1663599600000, '1203953.4986586301232635'],
//       [1663603200000, '1233424.9628539827472466'],
//       [1663606800000, '1199307.7183105841632625'],
//       [1663610400000, '1197997.0187059931847003'],
//       [1663614000000, '1178722.4884105005076729'],
//       [1663617600000, '1173791.221482077719897'],
//       [1663621200000, '1175295.1468642914686505'],
//       [1663624800000, '1129831.9454974058520724'],
//       [1663628400000, '1095361.8034161237636351'],
//       [1663632000000, '1076490.0137705154760747'],
//       [1663635600000, '1079440.2939096417182415'],
//       [1663639200000, '1081648.8479208109954758'],
//       [1663642800000, '1025266.8521251639456804'],
//       [1663646400000, '1019219.3334476876661969'],
//       [1663650000000, '1006801.0704100428756845'],
//       [1663653600000, '991717.1649882010667891'],
//       [1663657200000, '949668.2290196931967776'],
//       [1663660800000, '934256.429401900160606'],
//       [1663664400000, '930366.9203988840668094'],
//       [1663668000000, '935219.7540991483829463'],
//       [1663671600000, '924196.8718333688205738'],
//       [1663675200000, '908239.2655435287600261'],
//       [1663678800000, '917259.2786055308518265'],
//       [1663682400000, '931501.0073996424300823'],
//       [1663686000000, '904984.6923646680565356'],
//       [1663689600000, '894134.226275802593172'],
//       [1663693200000, '915633.861636400432101'],
//       [1663696800000, '944025.08341864735802'],
//       [1663700400000, '952488.9089349490942839'],
//       [1663704000000, '937855.6251372569294977'],
//       [1663707600000, '928517.2668111963160595'],
//       [1663711200000, '921509.7374707496196562'],
//       [1663714800000, '922434.4792572182022378'],
//       [1663718400000, '924822.6385784488955869'],
//       [1663722000000, '914758.8028413345425758'],
//       [1663725600000, '904968.4708004256055792'],
//       [1663729200000, '903086.4956584940373411'],
//       [1663732800000, '883452.8804512458995914'],
//       [1663736400000, '879343.3978803004084864'],
//       [1663740000000, '880125.0622371427105891'],
//       [1663743600000, '916908.4695625207291889'],
//       [1663747200000, '905450.5886747925097366'],
//       [1663750800000, '895022.9417526671014849'],
//       [1663754400000, '881498.6742732757896905'],
//       [1663758000000, '874190.8695665866103686'],
//       [1663761600000, '869472.5906514443726492'],
//       [1663765200000, '855342.5837267345482163'],
//       [1663768800000, '836836.1630233144376643'],
//       [1663772400000, '825138.4687071833840229'],
//       [1663776000000, '818743.1096602843892911'],
//       [1663779600000, '790925.4006616040664184'],
//       [1663783200000, '782291.6211953503498125'],
//       [1663786800000, '937338.3660748666068688'],
//       [1663790400000, '1012447.4818130746922758'],
//       [1663794000000, '1049102.6188302402080286'],
//       [1663797600000, '1114628.0655758531091531'],
//       [1663801200000, '1147156.1068865381295051'],
//       [1663804800000, '1151039.3213029517288954'],
//       [1663808400000, '1166528.2306692019218608'],
//       [1663812000000, '1175542.368463202272897'],
//       [1663815600000, '1176108.0398419191959031'],
//       [1663819200000, '1191487.2504027203712284'],
//       [1663822800000, '1198648.2570370907258909'],
//       [1663826400000, '1210343.5730088620828108'],
//       [1663830000000, '1195732.106736473857938'],
//       [1663833600000, '1192179.7681677743673019'],
//       [1663837200000, '1197052.1269014802158323'],
//       [1663840800000, '1216516.2080482408850825'],
//       [1663844400000, '1217666.7036800244122025'],
//       [1663848000000, '1229484.6038130741324816'],
//       [1663851600000, '1241115.3281158543244256'],
//       [1663855200000, '1269250.8055460093477992'],
//       [1663858800000, '1286402.5949173065662356'],
//       [1663862400000, '1293541.8932575870322461'],
//       [1663866000000, '1307706.021675095291236'],
//       [1663869600000, '1294592.9174311518432862'],
//       [1663873200000, '1132732.6131874568265419'],
//       [1663876800000, '1073766.2939354572006213'],
//       [1663880400000, '1069215.9885121152902429'],
//       [1663884000000, '1035772.4073987987991871'],
//       [1663887600000, '1007891.3002721645858637'],
//       [1663891200000, '1008028.8477440980391486'],
//       [1663894800000, '1006461.0593161624247895'],
//       [1663898400000, '1010251.7130028996132953'],
//       [1663902000000, '1006505.0795269910100418'],
//       [1663905600000, '1002753.8365597248096219'],
//       [1663909200000, '1014182.9802159084577152'],
//       [1663912800000, '1029041.8846396137667537'],
//       [1663916400000, '1029621.5247547926877496'],
//       [1663920000000, '1039548.9172029741924843'],
//       [1663923600000, '1051282.4003858683177556'],
//       [1663927200000, '1059229.7824664371847805'],
//       [1663930800000, '1069492.9392366704710736'],
//       [1663934400000, '1090191.3515112585294985'],
//       [1663938000000, '1087091.8234899385777789'],
//       [1663941600000, '1087391.9455620396107551'],
//       [1663945200000, '1117807.7456123923362713'],
//       [1663948800000, '1117947.168708793281116'],
//       [1663952400000, '1122528.2170870094924482'],
//       [1663956000000, '1127761.9346255872415036'],
//       [1663959600000, '1137274.3409789269838134'],
//       [1663963200000, '1126626.953231469997281'],
//       [1663966800000, '1112721.660318466946515'],
//       [1663970400000, '1111325.2804370158454077'],
//       [1663974000000, '1107016.5313984058081358'],
//       [1663977600000, '1099323.6726365068675461'],
//       [1663981200000, '1123607.5233594119584739'],
//       [1663984800000, '1128081.8415076118485239'],
//       [1663988400000, '1136293.859749465281439'],
//       [1663992000000, '1126411.8295228424562701'],
//       [1663995600000, '1116592.2968405242681615'],
//       [1663999200000, '1109866.5911398037879956'],
//       [1664002800000, '1108478.074398030304913'],
//       [1664006400000, '1107161.3462280948906914'],
//       [1664010000000, '1083167.7791446960478367'],
//       [1664013600000, '1067052.0229067334864771'],
//       [1664017200000, '1048375.7887695071926289'],
//       [1664020800000, '1017086.6478017878428467'],
//       [1664024400000, '996607.4058340665037098'],
//       [1664028000000, '980715.2584518278715979'],
//       [1664031600000, '942335.7618741756175858'],
//       [1664035200000, '925290.4679101627820322'],
//       [1664038800000, '904644.2274420708289355'],
//       [1664042400000, '878500.6064601680904726'],
//       [1664046000000, '848052.6592141247633886'],
//       [1664049600000, '824157.2641271122669334'],
//       [1664053200000, '798681.3178164782410461'],
//       [1664056800000, '804822.8986641211947847'],
//       [1664060400000, '791318.578524734590659'],
//       [1664064000000, '778527.4369462967061281'],
//       [1664067600000, '754355.4300220211111897'],
//       [1664071200000, '739267.0235379927314564'],
//       [1664074800000, '720539.5025226303859832'],
//       [1664078400000, '706077.4285192767221378'],
//       [1664082000000, '692923.4383755835591404'],
//       [1664085600000, '680808.7190100609789006'],
//       [1664089200000, '672108.4535645349933391'],
//       [1664092800000, '658310.7473187572801453'],
//       [1664096400000, '649927.4515223510896876'],
//       [1664100000000, '642210.5902032321203885'],
//       [1664103600000, '640175.3744017748433958'],
//       [1664107200000, '631756.5729537488759543'],
//       [1664110800000, '634949.3043118201704063'],
//       [1664114400000, '640467.2451946333513115'],
//       [1664118000000, '640000.8880102613678013'],
//       [1664121600000, '631604.6228928968394759'],
//       [1664125200000, '631600.6842096332764193'],
//       [1664128800000, '654668.0977139755916249'],
//       [1664132400000, '656357.5800694941948117'],
//       [1664136000000, '657276.7396611296957505'],
//       [1664139600000, '656687.619850967998023'],
//       [1664143200000, '653742.0126655394608806'],
//     ],
//   },
// ];
const getCryptoExchangesRouter = express_1.default.Router();
//FIRST ping the server of CoinGecko
getCryptoExchangesRouter.get('/', (req, res, next) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const serverStatus = yield axios_1.default.get('https://api.coingecko.com/api/v3/ping');
        if (serverStatus) {
            next();
        }
    }
    catch (error) {
        next(error); //TODO right error handler for express
    }
}));
//Second, make request to CoinGecko to list all exchanges and info (minus the history volume)
//* Here we use TRequestAttachData for the type of Request declaration by Express because in order to attach other properties (in this case the .data) to the Request object of express we will have to extends the original request's type by express . See .types.d.ts for more info
getCryptoExchangesRouter.get('/', (req, res, next) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const options = {
            params: {
                per_page: 5, //Only get the first 10 //TODO: Since Coingecko limit api call, find a way to implement for more than 10 call
            },
        };
        const response = yield axios_1.default.get('https://api.coingecko.com/api/v3/exchanges', options);
        if (response.status === 200) {
            //Attach data to next middleware
            req.data = response.data;
            if (typeof req.data !== 'undefined') {
                const exchangeIds = (0, utilities_1.getExchangeIds)(req.data);
                req.exchangeIds = exchangeIds; //Attach exchangeIds to next middleware
                next();
            }
        }
        //TODO handle error cases
    }
    catch (error) {
        next(error); //TODO right error handler for express
    }
}));
//Third, get the id from each of the exchange, with that id array make another call to get the volume history to display to the chart later
getCryptoExchangesRouter.get('/', (req, res, next) => __awaiter(void 0, void 0, void 0, function* () {
    var _a;
    const options = {
        params: {
            days: 7, //!This is for number of days history of the price chart
        },
    };
    const promiseArr = (_a = req.exchangeIds) === null || _a === void 0 ? void 0 : _a.map((eachId) => __awaiter(void 0, void 0, void 0, function* () {
        const url = `https://api.coingecko.com/api/v3/exchanges/${eachId}/volume_chart`;
        try {
            const response = yield axios_1.default.get(url, options);
            if (response.status === 200) {
                const volume_chart_7d = response.data;
                return {
                    id: eachId,
                    volume_chart_7d,
                };
            }
        }
        catch (error) {
            next(error);
        }
    }));
    const result = yield Promise.all(promiseArr);
    const final = result.map((eachVolumeChart) => {
        var _a;
        return (Object.assign(Object.assign({}, eachVolumeChart), (_a = req.data) === null || _a === void 0 ? void 0 : _a.find((exchange) => exchange.id === eachVolumeChart.id)));
    });
    return res.status(200).json(final);
}));
exports.default = getCryptoExchangesRouter;
